---
import Base from '../layouts/Base.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog', ({ data }) => !data.draft);

const sortedItems = posts
  .map((post) => ({
    tag: post.data.tags?.[0] || 'post',
    title: post.data.title,
    description: post.data.description || '',
    meta: post.data.meta || String(post.data.date.getFullYear()),
    image: post.data.image || '',
    order: post.data.order || 0,
    date: post.data.date,
    href: `/writing/${post.id}`,
  }))
  .sort((a, b) => b.order - a.order || b.date.getTime() - a.date.getTime());
---

<Base title="Writing" description="Ideas, guides, and project write-ups." activePage="writing">
  <div class="page-header">
    <h1 class="page-title">Writing</h1>
    <p class="page-description">Ideas, guides, and project write-ups.</p>
  </div>

  <div class="content-list">
    {sortedItems.map((item, i) => (
      <a class={`content-item${i === 0 ? ' featured' : ''}`} href={item.href}>
        {item.image && <div class="item-bg" style={`background-image: url('${item.image}');`}></div>}
        <div class="item-left">
          <span class="item-tag">{item.tag}</span>
          <span class="item-title" transition:name={`title-${item.href.split('/').pop()}`}>{item.title}</span>
        </div>
        <div class="item-meta">{item.meta}</div>
        {i === 0 && item.description && <div class="featured-desc">{item.description}</div>}
      </a>
    ))}
  </div>
</Base>
